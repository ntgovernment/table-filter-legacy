!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.TableFilter=t():e.TableFilter=t()}(this,()=>(()=>{"use strict";var e={d:(t,l)=>{for(var n in l)e.o(l,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:l[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{default:()=>i});class l{constructor(e,t={}){this.table=document.querySelector(e),this.options={searchInputClass:t.searchInputClass||"table-filter-search",noResultsClass:t.noResultsClass||"table-filter-no-results",...t},this.table?(this.filterContainer=null,this.searchInput=null,this.columnFilters=[],this.activeFilters={search:"",columns:{}},this.init()):console.warn(`Table not found: ${e}`)}init(){this.createFilterMarkup(),this.attachEventListeners()}createFilterMarkup(){const e=document.getElementById("ntgc-page-filters");if(e)return this.filterContainer=e,void(this.searchInput=document.getElementById("searchInput"));const t=document.createElement("div");t.id="ntgc-page-filters",t.className="row mt-5 d-print-none";const l=document.querySelector("[data-table-filter]"),n=l?.getAttribute("data-search-placeholder")||"Search",i=(l?.getAttribute("data-column-filters")||"").split(";").map(e=>e.trim()).filter(e=>e);t.innerHTML=`\n    \x3c!-- Free text search filter --\x3e\n    <div class="filter-option mb-1 col-lg-4" id="text-question">\n        <label for="searchInput">Search</label>\n        <div class="input-group">\n            <input type="text" name="project_title" id="searchInput" class="form-control rounded-0" placeholder="${n}" autocomplete="off">\n            <span class="clear-input" id="clearInput" hidden=""></span>\n        </div>\n    </div>\n\n    \x3c!-- Filter dropdowns will be generated dynamically --\x3e\n    <div id="filterControls" class="d-flex flex-nowrap gap-2 col-lg-8"></div>\n\n    <div class="mt-3 hidden" id="applied-filters">\n        <div class="filter-option" id="active-filters">\n            <strong>Applied filters:</strong>\n            <div class="d-inline-block pt-2" id="filterPillsContainer">\n                <span id="filterPills"></span>\n                <a href="#" id="clearAllFilters">Clear all</a>\n            </div>\n        </div>\n    </div>\n    `,this.table.parentNode.insertBefore(t,this.table),this.filterContainer=t,this.searchInput=document.getElementById("searchInput"),this.generateColumnFilters(i)}generateColumnFilters(e){if(!e.length)return;const t=document.getElementById("filterControls"),l=this.table.querySelector("thead");if(!l)return;const n=Array.from(l.querySelectorAll("th"));e.forEach((e,l)=>{const i=n.findIndex(t=>t.textContent.trim().toLowerCase()===e.toLowerCase());if(-1===i)return;const s=this.getUniqueColumnValues(i),r=document.createElement("div");r.className="filter-option flex-fill",r.style.cssText="flex: 1 1 0; min-width: 0;";const a=`selectInput${l+1}`,o="Year of finding"===e?"Year of issue":e,c=`Select ${o.toLowerCase()}`;r.innerHTML=`\n        <label for="${a}" class="ntgc-form-input--label">${o}</label>\n        <div>\n            <select name="select-input-${l+1}" id="${a}" class="form-select rounded-0">\n                <option value="all" selected="">${c}</option>\n                ${s.map(e=>`<option value="${e.toLowerCase()}">${e}</option>`).join("")}\n            </select>\n        </div>\n      `,t.appendChild(r),this.columnFilters.push({columnIndex:i,selectId:a,columnName:e})})}getUniqueColumnValues(e){const t=this.table.querySelector("tbody"),l=t?Array.from(t.querySelectorAll("tr")):[],n=new Set;return l.forEach(t=>{const l=t.querySelectorAll("td");if(l[e]){const t=l[e].textContent.trim();t&&n.add(t)}}),Array.from(n).sort((e,t)=>{const l=parseInt(e),n=parseInt(t);return isNaN(l)||isNaN(n)?e.localeCompare(t):l-n})}attachEventListeners(){this.searchInput&&this.searchInput.addEventListener("input",e=>{this.activeFilters.search=e.target.value,this.filterTable(),this.updateClearButton(),this.updateFilterPills()});const e=document.getElementById("clearInput");e&&e.addEventListener("click",()=>{this.searchInput.value="",this.activeFilters.search="",this.filterTable(),this.updateClearButton(),this.updateFilterPills()}),this.columnFilters.forEach(e=>{const t=document.getElementById(e.selectId);t&&t.addEventListener("change",t=>{const l=t.target.value;"all"===l?delete this.activeFilters.columns[e.columnIndex]:this.activeFilters.columns[e.columnIndex]=l,this.filterTable(),this.updateFilterPills()})});const t=document.getElementById("clearAllFilters");t&&t.addEventListener("click",e=>{e.preventDefault(),this.clearAllFilters()})}updateClearButton(){const e=document.getElementById("clearInput");e&&(this.searchInput.value?e.removeAttribute("hidden"):e.setAttribute("hidden",""))}filterTable(){const e=this.activeFilters.search.toLowerCase().trim(),t=this.table.querySelector("tbody"),l=t?t.querySelectorAll("tr"):this.table.querySelectorAll("tr");let n=0;l.forEach((l,i)=>{if(!t&&0===i)return;let s=!0;if(e&&(l.textContent.toLowerCase().includes(e)||(s=!1)),s)for(const[e,t]of Object.entries(this.activeFilters.columns)){const n=l.querySelectorAll("td")[e];if(n&&n.textContent.trim().toLowerCase()!==t){s=!1;break}}s?(l.style.display="",n++):l.style.display="none"}),this.updateNoResultsMessage(0===n)}updateFilterPills(){const e=document.getElementById("filterPills"),t=document.getElementById("applied-filters");if(!e||!t)return;const l=[];this.activeFilters.search&&l.push(`\n        <button type="button" class="filter-pill" tabindex="0" onclick="window.tableFilterInstance?.clearSearchFilter()" aria-label="Remove filter: ${this.activeFilters.search}">\n          <span class="filter-pill-label">${this.activeFilters.search}</span>\n          <span class="filter-pill-close" aria-hidden="true">×</span>\n        </button>\n      `);for(const[e,t]of Object.entries(this.activeFilters.columns))this.columnFilters.find(t=>t.columnIndex==e)&&l.push(`\n          <button type="button" class="filter-pill" tabindex="0" onclick="window.tableFilterInstance?.clearColumnFilter(${e})" aria-label="Remove filter: ${t}">\n            <span class="filter-pill-label">${t}</span>\n            <span class="filter-pill-close" aria-hidden="true">×</span>\n          </button>\n        `);l.length>0?(e.innerHTML=l.join(""),t.classList.remove("hidden")):(e.innerHTML="",t.classList.add("hidden"))}clearSearchFilter(){this.searchInput.value="",this.activeFilters.search="",this.filterTable(),this.updateClearButton(),this.updateFilterPills()}clearColumnFilter(e){delete this.activeFilters.columns[e];const t=this.columnFilters.find(t=>t.columnIndex==e);if(t){const e=document.getElementById(t.selectId);e&&(e.value="all")}this.filterTable(),this.updateFilterPills()}clearAllFilters(){this.searchInput.value="",this.activeFilters.search="",this.activeFilters.columns={},this.columnFilters.forEach(e=>{const t=document.getElementById(e.selectId);t&&(t.value="all")}),this.filterTable(),this.updateClearButton(),this.updateFilterPills()}updateNoResultsMessage(e){let t=document.querySelector(`.${this.options.noResultsClass}`);e&&!t?(t=document.createElement("div"),t.className=this.options.noResultsClass,t.textContent="No matching results found.",this.table.parentNode.insertBefore(t,this.table.nextSibling)):!e&&t&&t.remove()}}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-table-filter]").forEach(e=>{const t=e.getAttribute("data-table-id"),n=t?`#${t}`:e.id?`#${e.id}`:e,i=new l(n);window.tableFilterInstance||(window.tableFilterInstance=i)})});const n=l;"undefined"!=typeof window&&(window.TableFilter=l);const i=n;return t.default})());
//# sourceMappingURL=table-filter.js.map