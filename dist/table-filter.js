!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.TableFilter=t():e.TableFilter=t()}(this,()=>(()=>{"use strict";var e={d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{default:()=>i});class n{constructor(e,t={}){if(this.table=document.querySelector(e),this.options={searchInputClass:t.searchInputClass||"table-filter-search",noResultsClass:t.noResultsClass||"table-filter-no-results",...t},!this.table)return void console.warn(`Table not found: ${e}`);this.filterContainer=null,this.searchInput=null,this.columnFilters=[],this.activeFilters={search:"",columns:{}},this.sortState={columnIndex:null,direction:null};const n=document.querySelector("[data-table-filter]"),a=n?.getAttribute("data-pagination-items-per-page");this.paginationState={currentPage:1,itemsPerPage:a?parseInt(a,10):10,totalPages:1,enabled:!!a,availableSizes:[10,25,50,100]},this.init()}init(){this.table.setAttribute("data-table-filter",""),this.createFilterMarkup(),this.initializeTableHeaders(),this.attachEventListeners(),this.applyQueryStringFilters(),this.filterTable()}initializeTableHeaders(){const e=this.table.querySelector("thead");e&&e.querySelectorAll("th").forEach((e,t)=>{if(e.querySelector(".sort-icon"))return;const n=e.innerHTML;e.innerHTML="";const a=document.createElement("div");a.className="header-text",a.innerHTML=n,e.appendChild(a);const i=document.createElement("div");i.className="header-icons";const s=document.createElement("span");s.className="sort-icon",s.innerHTML='\n        <i class="fas fa-chevron-up sort-arrow sort-arrow-up"></i>\n        <i class="fas fa-chevron-down sort-arrow sort-arrow-down"></i>\n      ',i.appendChild(s),e.appendChild(i),e.addEventListener("click",()=>this.sortTable(t))})}createFilterMarkup(){const e=document.getElementById("ntgc-page-filters");if(e)return this.filterContainer=e,void(this.searchInput=document.getElementById("searchInput"));const t=document.createElement("div");t.id="ntgc-page-filters",t.className="row mt-5 d-print-none";const n=document.querySelector("[data-table-filter]"),a=n?.getAttribute("data-search-placeholder")||"Search",i=(n?.getAttribute("data-column-filters")||"").split(";").map(e=>e.trim()).filter(e=>e);t.innerHTML=`\n    \x3c!-- Free text search filter --\x3e\n    <div class="filter-option mb-1 col-lg-4" id="text-question">\n        <label for="searchInput">Search</label>\n        <div class="input-group">\n            <input type="text" name="project_title" id="searchInput" class="form-control rounded-0" placeholder="${a}" autocomplete="off">\n            <span class="clear-input" id="clearInput" hidden=""></span>\n        </div>\n    </div>\n\n    \x3c!-- Filter dropdowns will be generated dynamically --\x3e\n    <div id="filterControls" class="d-flex flex-nowrap col-lg-8" style="gap: 16px;"></div>\n\n    <div class="mt-3 hidden" id="applied-filters">\n        <div class="filter-option" id="active-filters">\n            <strong>Applied filters:</strong>\n            <div class="d-inline-block pt-2" id="filterPillsContainer">\n                <span id="filterPills"></span>\n                <button type="button" id="copyFilterLink" class="filter-link-button" style="display: none;" title="Copy filter link">\n                    <i class="fas fa-link"></i> Copy filter link\n                </button>\n                <a href="#" id="clearAllFilters">Clear all</a>\n            </div>\n        </div>\n    </div>\n    `,this.table.parentNode.insertBefore(t,this.table),this.filterContainer=t,this.searchInput=document.getElementById("searchInput"),this.generateColumnFilters(i)}generateColumnFilters(e){if(!e.length)return;const t=document.getElementById("filterControls"),n=this.table.querySelector("thead");if(!n)return;const a=Array.from(n.querySelectorAll("th"));e.forEach((e,n)=>{const i=a.findIndex(t=>t.textContent.trim().toLowerCase()===e.toLowerCase());if(-1===i)return;const s=this.getUniqueColumnValues(i),l=document.createElement("div");l.className="filter-option flex-fill",l.style.cssText="flex: 1 1 0; min-width: 0;";const r=`selectInput${n+1}`,o="Year of finding"===e?"Year of issue":e,c=`Select ${o.toLowerCase()}`;l.innerHTML=`\n        <label for="${r}" class="ntgc-form-input--label">${o}</label>\n        <div>\n            <select name="select-input-${n+1}" id="${r}" class="form-select rounded-0">\n                <option value="all" selected="">${c}</option>\n                ${s.map(e=>`<option value="${e.toLowerCase()}">${e}</option>`).join("")}\n            </select>\n        </div>\n      `,t.appendChild(l),this.columnFilters.push({columnIndex:i,selectId:r,columnName:e})})}getUniqueColumnValues(e){const t=this.table.querySelector("tbody"),n=t?Array.from(t.querySelectorAll("tr")):[],a=new Set;return n.forEach(t=>{const n=t.querySelectorAll("td");if(n[e]){const t=n[e].textContent.trim();t&&a.add(t)}}),Array.from(a).sort((e,t)=>{const n=parseInt(e),a=parseInt(t);return isNaN(n)||isNaN(a)?e.localeCompare(t):n-a})}attachEventListeners(){this.searchInput&&this.searchInput.addEventListener("input",e=>{this.activeFilters.search=e.target.value,this.paginationState.currentPage=1,this.filterTable(),this.updateClearButton(),this.updateFilterPills()});const e=document.getElementById("clearInput");e&&e.addEventListener("click",()=>{this.searchInput.value="",this.activeFilters.search="",this.paginationState.currentPage=1,this.filterTable(),this.updateClearButton(),this.updateFilterPills()}),this.columnFilters.forEach(e=>{const t=document.getElementById(e.selectId);t&&t.addEventListener("change",t=>{const n=t.target.value;"all"!==n&&(this.activeFilters.columns[e.columnIndex]||(this.activeFilters.columns[e.columnIndex]=[]),this.activeFilters.columns[e.columnIndex].includes(n)||this.activeFilters.columns[e.columnIndex].push(n),t.target.value="all",this.updateDropdownOptions(e.columnIndex)),this.paginationState.currentPage=1,this.filterTable(),this.updateFilterPills()})});const t=document.getElementById("clearAllFilters");t&&t.addEventListener("click",e=>{e.preventDefault(),this.clearAllFilters()});const n=document.getElementById("copyFilterLink");n&&n.addEventListener("click",()=>{this.copyFilterURL()})}updateClearButton(){const e=document.getElementById("clearInput");e&&(this.searchInput.value?e.removeAttribute("hidden"):e.setAttribute("hidden",""))}filterTable(){const e=this.activeFilters.search.toLowerCase().trim(),t=this.table.querySelector("tbody"),n=t?t.querySelectorAll("tr"):this.table.querySelectorAll("tr");let a=[];n.forEach((n,i)=>{if(n.hasAttribute("data-original-index")||n.setAttribute("data-original-index",i.toString()),!t&&0===i)return;let s=!0;if(e&&(n.textContent.toLowerCase().includes(e)||(s=!1)),s)for(const[e,t]of Object.entries(this.activeFilters.columns)){const a=n.querySelectorAll("td")[e];if(a&&t.length>0){const e=a.textContent.trim().toLowerCase();if(!t.includes(e)){s=!1;break}}}s?a.push(n):n.style.display="none"});const i=a.length;if(this.paginationState.enabled&&i>0){this.paginationState.totalPages=Math.ceil(i/this.paginationState.itemsPerPage),this.paginationState.currentPage>this.paginationState.totalPages&&(this.paginationState.currentPage=1);const e=(this.paginationState.currentPage-1)*this.paginationState.itemsPerPage,t=e+this.paginationState.itemsPerPage;a.forEach((n,a)=>{n.style.display=a>=e&&a<t?"":"none"}),this.renderPaginationControls(i)}else a.forEach(e=>{e.style.display=""}),this.removePaginationControls();this.updateNoResultsMessage(0===i)}updateFilterPills(){const e=document.getElementById("filterPills"),t=document.getElementById("applied-filters");if(!e||!t)return;const n=[];this.activeFilters.search&&n.push(`\n        <button type="button" class="filter-pill" tabindex="0" onclick="window.tableFilterInstance?.clearSearchFilter()" aria-label="Remove filter: ${this.activeFilters.search}">\n          <span class="filter-pill-label">${this.activeFilters.search}</span>\n          <span class="filter-pill-close" aria-hidden="true">×</span>\n        </button>\n      `);for(const[e,t]of Object.entries(this.activeFilters.columns))this.columnFilters.find(t=>t.columnIndex==e)&&Array.isArray(t)&&t.forEach(t=>{n.push(`\n            <button type="button" class="filter-pill" tabindex="0" onclick="window.tableFilterInstance?.clearColumnFilter(${e}, '${t}')" aria-label="Remove filter: ${t}">\n              <span class="filter-pill-label">${t}</span>\n              <span class="filter-pill-close" aria-hidden="true">×</span>\n            </button>\n          `)});if(n.length>0){e.innerHTML=n.join(""),t.classList.remove("hidden");const a=document.getElementById("copyFilterLink");a&&(a.style.display="inline-flex")}else{e.innerHTML="",t.classList.add("hidden");const n=document.getElementById("copyFilterLink");n&&(n.style.display="none")}}clearSearchFilter(){this.searchInput.value="",this.activeFilters.search="",this.filterTable(),this.updateClearButton(),this.updateFilterPills()}clearColumnFilter(e,t=null){if(null===t)delete this.activeFilters.columns[e];else{const n=this.activeFilters.columns[e];if(n){const a=n.indexOf(t);a>-1&&n.splice(a,1),0===n.length&&delete this.activeFilters.columns[e]}}this.updateDropdownOptions(e),this.paginationState.currentPage=1,this.filterTable(),this.updateFilterPills()}updateDropdownOptions(e){const t=this.columnFilters.find(t=>t.columnIndex==e);if(!t)return;const n=document.getElementById(t.selectId);if(!n)return;const a=this.activeFilters.columns[e]||[];Array.from(n.options).forEach(e=>{"all"!==e.value&&(a.includes(e.value)?e.style.display="none":e.style.display="")})}sortTable(e){const t=this.table.querySelector("tbody");if(!t)return;const n=this.table.querySelectorAll("thead th"),a=Array.from(t.querySelectorAll("tr"));let i="asc";this.sortState.columnIndex===e&&("asc"===this.sortState.direction?i="desc":"desc"===this.sortState.direction&&(i=null)),this.sortState.columnIndex=i?e:null,this.sortState.direction=i,this.paginationState.currentPage=1,n.forEach(e=>{e.classList.remove("sort-asc","sort-desc")}),i&&n[e].classList.add(`sort-${i}`),i?a.sort((t,n)=>{const a=t.querySelectorAll("td")[e],s=n.querySelectorAll("td")[e];if(!a||!s)return 0;const l=a.textContent.trim(),r=s.textContent.trim(),o=parseFloat(l.replace(/[^0-9.-]/g,"")),c=parseFloat(r.replace(/[^0-9.-]/g,""));if(!isNaN(o)&&!isNaN(c))return"asc"===i?o-c:c-o;const d=l.localeCompare(r);return"asc"===i?d:-d}):a.sort((e,t)=>parseInt(e.getAttribute("data-original-index")||"0")-parseInt(t.getAttribute("data-original-index")||"0")),a.forEach(e=>t.appendChild(e))}applyQueryStringFilters(){const e=new URLSearchParams(window.location.search);let t=!1;const n=e.get("search");n&&this.searchInput&&(this.searchInput.value=n,this.activeFilters.search=n,this.updateClearButton(),t=!0);const a=e.get("page");if(a&&this.paginationState.enabled){const e=parseInt(a,10);e>0&&(this.paginationState.currentPage=e)}e.forEach((e,n)=>{if("search"===n||"page"===n)return;const a=this.columnFilters.find(e=>e.columnName===n);if(a){const n=document.getElementById(a.selectId);if(!n)return;Array.from(n.options).find(t=>t.value===e.toLowerCase())&&(this.activeFilters.columns[a.columnIndex]||(this.activeFilters.columns[a.columnIndex]=[]),this.activeFilters.columns[a.columnIndex].includes(e.toLowerCase())||this.activeFilters.columns[a.columnIndex].push(e.toLowerCase()),this.updateDropdownOptions(a.columnIndex),t=!0)}}),t&&(this.filterTable(),this.updateFilterPills())}generateFilterURL(){const e=window.location.origin+window.location.pathname,t=new URLSearchParams;this.activeFilters.search&&t.append("search",this.activeFilters.search);for(const[e,n]of Object.entries(this.activeFilters.columns)){const a=this.columnFilters.find(t=>t.columnIndex==e);a&&Array.isArray(n)&&n.forEach(e=>{t.append(a.columnName,e)})}this.paginationState.enabled&&this.paginationState.currentPage>1&&t.append("page",this.paginationState.currentPage.toString());const n=t.toString();return n?`${e}?${n}`:e}copyFilterURL(){const e=this.generateFilterURL();navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(e).then(()=>{this.showCopyFeedback(!0)}).catch(t=>{console.warn("Clipboard API failed, using fallback:",t),this.fallbackCopyURL(e)}):this.fallbackCopyURL(e)}fallbackCopyURL(e){const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-9999px",t.style.top="-9999px",document.body.appendChild(t),t.focus(),t.select();try{const e=document.execCommand("copy");this.showCopyFeedback(e)}catch(e){console.error("Fallback copy failed:",e),this.showCopyFeedback(!1)}document.body.removeChild(t)}showCopyFeedback(e){const t=document.getElementById("copyFilterLink");if(t)if(e){const e=t.innerHTML;t.classList.add("copied"),t.innerHTML='<i class="fas fa-check"></i> Copied!',t.disabled=!0,setTimeout(()=>{t.classList.remove("copied"),t.innerHTML=e,t.disabled=!1},2e3)}else alert("Failed to copy link. Please try again.")}clearAllFilters(){this.searchInput.value="",this.activeFilters.search="",this.activeFilters.columns={},this.columnFilters.forEach(e=>{const t=document.getElementById(e.selectId);t&&(t.value="all",Array.from(t.options).forEach(e=>{e.style.display=""}))}),this.paginationState.currentPage=1,this.filterTable(),this.updateClearButton(),this.updateFilterPills()}renderPaginationControls(e){let t;this.removePaginationControls(),t=window.innerWidth<=768?this.generateMobilePaginationHTML(e):this.generatePaginationHTML(e);const n=document.createElement("div");n.id="tablePaginationControls",n.className="table-pagination-wrapper mt-3",n.innerHTML=t,this.table.parentNode.insertBefore(n,this.table.nextSibling),this.attachPaginationEventListeners()}removePaginationControls(){const e=document.getElementById("tablePaginationControls");e&&e.remove()}generatePaginationHTML(e){const{currentPage:t,itemsPerPage:n,totalPages:a,availableSizes:i}=this.paginationState,s=e>0?(t-1)*n+1:0,l=Math.min(t*n,e);return`\n      <div class="pagination-container">\n        \n      <div class="page-size-control">\n        <label for="pageSizeSelect" class="page-size-label">Show:</label>\n        <select id="pageSizeSelect" class="form-select form-select-sm page-size-select">\n          ${i.map(e=>`<option value="${e}" ${e===n?"selected":""}>${e}</option>`).join("")}\n        </select>\n        <span class="results-info">Showing ${s}-${l} of ${e} results</span>\n      </div>\n    \n        <nav aria-label="Table pagination" class="pagination-nav">\n          <ul class="pagination pagination-sm mb-0">\n            ${this.buildPageButtons(t,a)}\n          </ul>\n        </nav>\n      </div>\n    `}generateMobilePaginationHTML(e){const{currentPage:t,itemsPerPage:n,totalPages:a,availableSizes:i}=this.paginationState,s=e>0?(t-1)*n+1:0,l=Math.min(t*n,e);return`\n      <div class="pagination-container pagination-mobile">\n        \n      <div class="page-size-control">\n        <label for="pageSizeSelect" class="page-size-label">Show:</label>\n        <select id="pageSizeSelect" class="form-select form-select-sm page-size-select">\n          ${i.map(e=>`<option value="${e}" ${e===n?"selected":""}>${e}</option>`).join("")}\n        </select>\n        <span class="results-info">Showing ${s}-${l} of ${e}</span>\n      </div>\n    \n        <nav aria-label="Table pagination" class="pagination-nav">\n          <ul class="pagination pagination-sm mb-0">\n            \n      <li class="page-item ${1===t?"disabled":""}">\n        <button class="page-link" data-page="${t-1}" ${1===t?"disabled":""} aria-label="Previous">\n          <i class="fas fa-chevron-left"></i>\n        </button>\n      </li>\n      <li class="page-item active">\n        <span class="page-link">${t} of ${a}</span>\n      </li>\n      <li class="page-item ${t===a?"disabled":""}">\n        <button class="page-link" data-page="${t+1}" ${t===a?"disabled":""} aria-label="Next">\n          <i class="fas fa-chevron-right"></i>\n        </button>\n      </li>\n    \n          </ul>\n        </nav>\n      </div>\n    `}buildPageButtons(e,t){const n=[];return n.push(`\n      <li class="page-item page-item-nav ${1===e?"disabled":""}">\n        <button class="page-link page-link-nav" data-page="${e-1}" ${1===e?"disabled":""} aria-label="Previous">\n          <span class="page-nav-text">Previous</span>\n        </button>\n      </li>\n    `),this.getPageNumbers(e,t).forEach(t=>{"..."===t?n.push('\n          <li class="page-item page-item-ellipsis">\n            <span class="page-ellipsis">...</span>\n          </li>\n        '):n.push(`\n          <li class="page-item ${t===e?"active":""}">\n            <button class="page-link page-link-number" data-page="${t}" data-selected="${t===e?"True":"False"}" ${t===e?'aria-current="page"':""}>\n              ${t}\n            </button>\n          </li>\n        `)}),n.push(`\n      <li class="page-item page-item-nav ${e===t?"disabled":""}">\n        <button class="page-link page-link-nav" data-page="${e+1}" ${e===t?"disabled":""} aria-label="Next">\n          <span class="page-nav-text">Next</span>\n          <i class="fas fa-chevron-right"></i>\n        </button>\n      </li>\n    `),n.join("")}getPageNumbers(e,t){const n=[];if(t<=7)for(let e=1;e<=t;e++)n.push(e);else{n.push(1),e>3&&n.push("...");const a=Math.max(2,e-1),i=Math.min(t-1,e+1);for(let e=a;e<=i;e++)n.push(e);e<t-2&&n.push("..."),n.push(t)}return n}attachPaginationEventListeners(){const e=document.getElementById("pageSizeSelect");e&&e.addEventListener("change",e=>{this.paginationState.itemsPerPage=parseInt(e.target.value,10),this.paginationState.currentPage=1,this.filterTable()}),document.querySelectorAll(".pagination-container .page-link[data-page]").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const n=parseInt(e.getAttribute("data-page"),10);n>=1&&n<=this.paginationState.totalPages&&(this.paginationState.currentPage=n,this.filterTable(),this.table.scrollIntoView({behavior:"smooth",block:"start"}))})})}updateNoResultsMessage(e){let t=document.querySelector(`.${this.options.noResultsClass}`);e&&!t?(t=document.createElement("div"),t.className=this.options.noResultsClass,t.innerHTML='\n        <div class="info-alert-bar"></div>\n        <div class="info-alert-content">\n          <div class="info-alert-header">\n            <svg class="info-alert-icon" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="none">\n              <path d="M16 4.33335C19.0942 4.33335 22.0616 5.56252 24.2495 7.75044C26.4375 9.93837 27.6666 12.9058 27.6666 16C27.6666 19.0942 26.4375 22.0617 24.2495 24.2496C22.0616 26.4375 19.0942 27.6667 16 27.6667C12.9058 27.6667 9.9383 26.4375 7.75038 24.2496C5.56246 22.0617 4.33329 19.0942 4.33329 16C4.33329 12.9058 5.56246 9.93837 7.75038 7.75044C9.9383 5.56252 12.9058 4.33335 16 4.33335ZM16 29.3334C19.5362 29.3334 22.9276 27.9286 25.428 25.4281C27.9285 22.9276 29.3333 19.5362 29.3333 16C29.3333 12.4638 27.9285 9.07241 25.428 6.57193C22.9276 4.07145 19.5362 2.66669 16 2.66669C12.4637 2.66669 9.07235 4.07145 6.57187 6.57193C4.07138 9.07241 2.66663 12.4638 2.66663 16C2.66663 19.5362 4.07138 22.9276 6.57187 25.4281C9.07235 27.9286 12.4637 29.3334 16 29.3334ZM13.5 21C13.0416 21 12.6666 21.375 12.6666 21.8334C12.6666 22.2917 13.0416 22.6667 13.5 22.6667H18.5C18.9583 22.6667 19.3333 22.2917 19.3333 21.8334C19.3333 21.375 18.9583 21 18.5 21H16.8333V15.1667C16.8333 14.7084 16.4583 14.3334 16 14.3334H13.9166C13.4583 14.3334 13.0833 14.7084 13.0833 15.1667C13.0833 15.625 13.4583 16 13.9166 16H15.1666V21H13.5ZM16 12.25C16.3315 12.25 16.6494 12.1183 16.8838 11.8839C17.1183 11.6495 17.25 11.3315 17.25 11C17.25 10.6685 17.1183 10.3506 16.8838 10.1161C16.6494 9.88172 16.3315 9.75002 16 9.75002C15.6684 9.75002 15.3505 9.88172 15.1161 10.1161C14.8817 10.3506 14.75 10.6685 14.75 11C14.75 11.3315 14.8817 11.6495 15.1161 11.8839C15.3505 12.1183 15.6684 12.25 16 12.25Z" fill="#107CC0"/>\n            </svg>\n            <div class="info-alert-text">\n              <div class="info-alert-title">No matching results found</div>\n              <div class="info-alert-message">Try adjusting your search terms or filters to find what you\'re looking for.</div>\n            </div>\n          </div>\n        </div>\n      ',this.table.parentNode.insertBefore(t,this.table.nextSibling)):!e&&t&&t.remove()}}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-table-filter]").forEach(e=>{const t=e.getAttribute("data-table-id"),a=t?`#${t}`:e.id?`#${e.id}`:e,i=new n(a);window.tableFilterInstance||(window.tableFilterInstance=i)})});const a=n;"undefined"!=typeof window&&(window.TableFilter=n);const i=a;return t.default})());
//# sourceMappingURL=table-filter.js.map