!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.TableFilter=t():e.TableFilter=t()}(this,()=>(()=>{"use strict";var e={d:(t,l)=>{for(var i in l)e.o(l,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:l[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{default:()=>n});class l{constructor(e,t={}){this.table=document.querySelector(e),this.options={searchInputClass:t.searchInputClass||"table-filter-search",noResultsClass:t.noResultsClass||"table-filter-no-results",...t},this.table?(this.filterContainer=null,this.searchInput=null,this.columnFilters=[],this.activeFilters={search:"",columns:{}},this.sortState={columnIndex:null,direction:null},this.init()):console.warn(`Table not found: ${e}`)}init(){this.table.setAttribute("data-table-filter",""),this.createFilterMarkup(),this.initializeTableHeaders(),this.attachEventListeners(),this.applyQueryStringFilters()}initializeTableHeaders(){const e=this.table.querySelector("thead");e&&e.querySelectorAll("th").forEach((e,t)=>{if(e.querySelector(".sort-icon"))return;const l=e.innerHTML;e.innerHTML="";const i=document.createElement("div");i.className="header-text",i.innerHTML=l,e.appendChild(i);const n=document.createElement("div");n.className="header-icons";const s=document.createElement("span");s.className="sort-icon",s.innerHTML='\n        <i class="fas fa-chevron-up sort-arrow sort-arrow-up"></i>\n        <i class="fas fa-chevron-down sort-arrow sort-arrow-down"></i>\n      ',n.appendChild(s),e.appendChild(n),e.addEventListener("click",()=>this.sortTable(t))})}createFilterMarkup(){const e=document.getElementById("ntgc-page-filters");if(e)return this.filterContainer=e,void(this.searchInput=document.getElementById("searchInput"));const t=document.createElement("div");t.id="ntgc-page-filters",t.className="row mt-5 d-print-none";const l=document.querySelector("[data-table-filter]"),i=l?.getAttribute("data-search-placeholder")||"Search",n=(l?.getAttribute("data-column-filters")||"").split(";").map(e=>e.trim()).filter(e=>e);t.innerHTML=`\n    \x3c!-- Free text search filter --\x3e\n    <div class="filter-option mb-1 col-lg-4" id="text-question">\n        <label for="searchInput">Search</label>\n        <div class="input-group">\n            <input type="text" name="project_title" id="searchInput" class="form-control rounded-0" placeholder="${i}" autocomplete="off">\n            <span class="clear-input" id="clearInput" hidden=""></span>\n        </div>\n    </div>\n\n    \x3c!-- Filter dropdowns will be generated dynamically --\x3e\n    <div id="filterControls" class="d-flex flex-nowrap col-lg-8" style="gap: 16px;"></div>\n\n    <div class="mt-3 hidden" id="applied-filters">\n        <div class="filter-option" id="active-filters">\n            <strong>Applied filters:</strong>\n            <div class="d-inline-block pt-2" id="filterPillsContainer">\n                <span id="filterPills"></span>\n                <button type="button" id="copyFilterLink" class="filter-link-button" style="display: none;" title="Copy filter link">\n                    <i class="fas fa-link"></i> Copy filter link\n                </button>\n                <a href="#" id="clearAllFilters">Clear all</a>\n            </div>\n        </div>\n    </div>\n    `,this.table.parentNode.insertBefore(t,this.table),this.filterContainer=t,this.searchInput=document.getElementById("searchInput"),this.generateColumnFilters(n)}generateColumnFilters(e){if(!e.length)return;const t=document.getElementById("filterControls"),l=this.table.querySelector("thead");if(!l)return;const i=Array.from(l.querySelectorAll("th"));e.forEach((e,l)=>{const n=i.findIndex(t=>t.textContent.trim().toLowerCase()===e.toLowerCase());if(-1===n)return;const s=this.getUniqueColumnValues(n),r=document.createElement("div");r.className="filter-option flex-fill",r.style.cssText="flex: 1 1 0; min-width: 0;";const a=`selectInput${l+1}`,o="Year of finding"===e?"Year of issue":e,c=`Select ${o.toLowerCase()}`;r.innerHTML=`\n        <label for="${a}" class="ntgc-form-input--label">${o}</label>\n        <div>\n            <select name="select-input-${l+1}" id="${a}" class="form-select rounded-0">\n                <option value="all" selected="">${c}</option>\n                ${s.map(e=>`<option value="${e.toLowerCase()}">${e}</option>`).join("")}\n            </select>\n        </div>\n      `,t.appendChild(r),this.columnFilters.push({columnIndex:n,selectId:a,columnName:e})})}getUniqueColumnValues(e){const t=this.table.querySelector("tbody"),l=t?Array.from(t.querySelectorAll("tr")):[],i=new Set;return l.forEach(t=>{const l=t.querySelectorAll("td");if(l[e]){const t=l[e].textContent.trim();t&&i.add(t)}}),Array.from(i).sort((e,t)=>{const l=parseInt(e),i=parseInt(t);return isNaN(l)||isNaN(i)?e.localeCompare(t):l-i})}attachEventListeners(){this.searchInput&&this.searchInput.addEventListener("input",e=>{this.activeFilters.search=e.target.value,this.filterTable(),this.updateClearButton(),this.updateFilterPills()});const e=document.getElementById("clearInput");e&&e.addEventListener("click",()=>{this.searchInput.value="",this.activeFilters.search="",this.filterTable(),this.updateClearButton(),this.updateFilterPills()}),this.columnFilters.forEach(e=>{const t=document.getElementById(e.selectId);t&&t.addEventListener("change",t=>{const l=t.target.value;"all"!==l&&(this.activeFilters.columns[e.columnIndex]||(this.activeFilters.columns[e.columnIndex]=[]),this.activeFilters.columns[e.columnIndex].includes(l)||this.activeFilters.columns[e.columnIndex].push(l),t.target.value="all",this.updateDropdownOptions(e.columnIndex)),this.filterTable(),this.updateFilterPills()})});const t=document.getElementById("clearAllFilters");t&&t.addEventListener("click",e=>{e.preventDefault(),this.clearAllFilters()});const l=document.getElementById("copyFilterLink");l&&l.addEventListener("click",()=>{this.copyFilterURL()})}updateClearButton(){const e=document.getElementById("clearInput");e&&(this.searchInput.value?e.removeAttribute("hidden"):e.setAttribute("hidden",""))}filterTable(){const e=this.activeFilters.search.toLowerCase().trim(),t=this.table.querySelector("tbody"),l=t?t.querySelectorAll("tr"):this.table.querySelectorAll("tr");let i=0;l.forEach((l,n)=>{if(l.hasAttribute("data-original-index")||l.setAttribute("data-original-index",n.toString()),!t&&0===n)return;let s=!0;if(e&&(l.textContent.toLowerCase().includes(e)||(s=!1)),s)for(const[e,t]of Object.entries(this.activeFilters.columns)){const i=l.querySelectorAll("td")[e];if(i&&t.length>0){const e=i.textContent.trim().toLowerCase();if(!t.includes(e)){s=!1;break}}}s?(l.style.display="",i++):l.style.display="none"}),this.updateNoResultsMessage(0===i)}updateFilterPills(){const e=document.getElementById("filterPills"),t=document.getElementById("applied-filters");if(!e||!t)return;const l=[];this.activeFilters.search&&l.push(`\n        <button type="button" class="filter-pill" tabindex="0" onclick="window.tableFilterInstance?.clearSearchFilter()" aria-label="Remove filter: ${this.activeFilters.search}">\n          <span class="filter-pill-label">${this.activeFilters.search}</span>\n          <span class="filter-pill-close" aria-hidden="true">×</span>\n        </button>\n      `);for(const[e,t]of Object.entries(this.activeFilters.columns))this.columnFilters.find(t=>t.columnIndex==e)&&Array.isArray(t)&&t.forEach(t=>{l.push(`\n            <button type="button" class="filter-pill" tabindex="0" onclick="window.tableFilterInstance?.clearColumnFilter(${e}, '${t}')" aria-label="Remove filter: ${t}">\n              <span class="filter-pill-label">${t}</span>\n              <span class="filter-pill-close" aria-hidden="true">×</span>\n            </button>\n          `)});if(l.length>0){e.innerHTML=l.join(""),t.classList.remove("hidden");const i=document.getElementById("copyFilterLink");i&&(i.style.display="inline-flex")}else{e.innerHTML="",t.classList.add("hidden");const l=document.getElementById("copyFilterLink");l&&(l.style.display="none")}}clearSearchFilter(){this.searchInput.value="",this.activeFilters.search="",this.filterTable(),this.updateClearButton(),this.updateFilterPills()}clearColumnFilter(e,t=null){if(null===t)delete this.activeFilters.columns[e];else{const l=this.activeFilters.columns[e];if(l){const i=l.indexOf(t);i>-1&&l.splice(i,1),0===l.length&&delete this.activeFilters.columns[e]}}this.updateDropdownOptions(e),this.filterTable(),this.updateFilterPills()}updateDropdownOptions(e){const t=this.columnFilters.find(t=>t.columnIndex==e);if(!t)return;const l=document.getElementById(t.selectId);if(!l)return;const i=this.activeFilters.columns[e]||[];Array.from(l.options).forEach(e=>{"all"!==e.value&&(i.includes(e.value)?e.style.display="none":e.style.display="")})}sortTable(e){const t=this.table.querySelector("tbody");if(!t)return;const l=this.table.querySelectorAll("thead th"),i=Array.from(t.querySelectorAll("tr"));let n="asc";this.sortState.columnIndex===e&&("asc"===this.sortState.direction?n="desc":"desc"===this.sortState.direction&&(n=null)),this.sortState.columnIndex=n?e:null,this.sortState.direction=n,l.forEach(e=>{e.classList.remove("sort-asc","sort-desc")}),n&&l[e].classList.add(`sort-${n}`),n?i.sort((t,l)=>{const i=t.querySelectorAll("td")[e],s=l.querySelectorAll("td")[e];if(!i||!s)return 0;const r=i.textContent.trim(),a=s.textContent.trim(),o=parseFloat(r.replace(/[^0-9.-]/g,"")),c=parseFloat(a.replace(/[^0-9.-]/g,""));if(!isNaN(o)&&!isNaN(c))return"asc"===n?o-c:c-o;const d=r.localeCompare(a);return"asc"===n?d:-d}):i.sort((e,t)=>parseInt(e.getAttribute("data-original-index")||"0")-parseInt(t.getAttribute("data-original-index")||"0")),i.forEach(e=>t.appendChild(e))}applyQueryStringFilters(){const e=new URLSearchParams(window.location.search);let t=!1;const l=e.get("search");l&&this.searchInput&&(this.searchInput.value=l,this.activeFilters.search=l,this.updateClearButton(),t=!0),e.forEach((e,l)=>{if("search"===l)return;const i=this.columnFilters.find(e=>e.columnName===l);if(i){const l=document.getElementById(i.selectId);if(!l)return;Array.from(l.options).find(t=>t.value===e.toLowerCase())&&(this.activeFilters.columns[i.columnIndex]||(this.activeFilters.columns[i.columnIndex]=[]),this.activeFilters.columns[i.columnIndex].includes(e.toLowerCase())||this.activeFilters.columns[i.columnIndex].push(e.toLowerCase()),this.updateDropdownOptions(i.columnIndex),t=!0)}}),t&&(this.filterTable(),this.updateFilterPills())}generateFilterURL(){const e=window.location.origin+window.location.pathname,t=new URLSearchParams;this.activeFilters.search&&t.append("search",this.activeFilters.search);for(const[e,l]of Object.entries(this.activeFilters.columns)){const i=this.columnFilters.find(t=>t.columnIndex==e);i&&Array.isArray(l)&&l.forEach(e=>{t.append(i.columnName,e)})}const l=t.toString();return l?`${e}?${l}`:e}copyFilterURL(){const e=this.generateFilterURL();navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(e).then(()=>{this.showCopyFeedback(!0)}).catch(t=>{console.warn("Clipboard API failed, using fallback:",t),this.fallbackCopyURL(e)}):this.fallbackCopyURL(e)}fallbackCopyURL(e){const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-9999px",t.style.top="-9999px",document.body.appendChild(t),t.focus(),t.select();try{const e=document.execCommand("copy");this.showCopyFeedback(e)}catch(e){console.error("Fallback copy failed:",e),this.showCopyFeedback(!1)}document.body.removeChild(t)}showCopyFeedback(e){const t=document.getElementById("copyFilterLink");if(t)if(e){const e=t.innerHTML;t.classList.add("copied"),t.innerHTML='<i class="fas fa-check"></i> Copied!',t.disabled=!0,setTimeout(()=>{t.classList.remove("copied"),t.innerHTML=e,t.disabled=!1},2e3)}else alert("Failed to copy link. Please try again.")}clearAllFilters(){this.searchInput.value="",this.activeFilters.search="",this.activeFilters.columns={},this.columnFilters.forEach(e=>{const t=document.getElementById(e.selectId);t&&(t.value="all",Array.from(t.options).forEach(e=>{e.style.display=""}))}),this.filterTable(),this.updateClearButton(),this.updateFilterPills()}updateNoResultsMessage(e){let t=document.querySelector(`.${this.options.noResultsClass}`);e&&!t?(t=document.createElement("div"),t.className=this.options.noResultsClass,t.textContent="No matching results found.",this.table.parentNode.insertBefore(t,this.table.nextSibling)):!e&&t&&t.remove()}}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-table-filter]").forEach(e=>{const t=e.getAttribute("data-table-id"),i=t?`#${t}`:e.id?`#${e.id}`:e,n=new l(i);window.tableFilterInstance||(window.tableFilterInstance=n)})});const i=l;"undefined"!=typeof window&&(window.TableFilter=l);const n=i;return t.default})());
//# sourceMappingURL=table-filter.js.map